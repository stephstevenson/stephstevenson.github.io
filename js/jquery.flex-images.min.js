(function(a){a.fn.flexImages=function(c){var d=a.extend({container:".item",object:"img",rowHeight:180,maxRows:0,truncate:0},c);return this.each(function(){var e=a(this),f=a(e).find(d.container),k=[],o=new Date().getTime(),p=window.getComputedStyle?getComputedStyle(f[0],null):f[0].currentStyle;d.margin=(parseInt(p.marginLeft)||0)+(parseInt(p.marginRight)||0)+(Math.round(parseFloat(p.borderLeftWidth))||0)+(Math.round(parseFloat(p.borderRightWidth))||0);for(j=0;j<f.length;j++){var l=f[j],n=parseInt(l.getAttribute("data-w")),m=n*(d.rowHeight/parseInt(l.getAttribute("data-h"))),g=a(l).find(d.object);k.push([l,n,m,g,g.data("src")])}b(e,k,d);a(window).off("resize.flexImages"+e.data("flex-t"));a(window).on("resize.flexImages"+o,function(){b(e,k,d)});e.data("flex-t",o)})};function b(c,m,f,k){var q,p,l=1,t=1,d=c.width()-2,s=[],e=0,g=f.rowHeight;if(!d){d=c.width()-2}function n(o){if(f.maxRows&&t>f.maxRows||f.truncate&&o&&t>1){s[q][0].style.display="none"}else{if(s[q][4]){s[q][3].attr("src",s[q][4]);s[q][4]=""}s[q][0].style.width=p+"px";s[q][0].style.height=g+"px";s[q][0].style.display="block"}}for(i=0;i<m.length;i++){s.push(m[i]);e+=m[i][2]+f.margin;if(e>=d){var r=s.length*f.margin;l=(d-r)/(e-r),g=Math.ceil(f.rowHeight*l),exact_w=0,p;for(q=0;q<s.length;q++){p=Math.ceil(s[q][2]*l);exact_w+=p+f.margin;if(exact_w>d){p-=exact_w-d}n()}s=[],e=0;t++}}for(q=0;q<s.length;q++){p=Math.floor(s[q][2]*l),h=Math.floor(f.rowHeight*l);n(true)}if(!k&&d!=c.width()){b(c,m,f,true)}}}(jQuery));